<template>
    <div id="chatFooter" class="bg-white w-100 border-top">
        <div class="row d-flex align-items-center mx-0 py-4">
            <div class="col-1 col-md-2">
                <div class="">
                    <img class="chat-companion-user-pic rounded-circle my-0 mx-auto"
                         v-bind:src="userPic" v-bind:alt="currentDialog.firstname" />
                </div>
            </div>
            <div class="col-9 col-md-8 pl-0">
                <div class="form">
                    <div class="form-row align-items-center ">
                        <div class="col-12  p-0">
                            <label class="sr-only d-none" for="txtMessage">Написать сообщение</label>
                            <input type="search"
                                   v-model="newMessage"
                                   @keydown="onMessageKeyDown($event)"
                                   class="form-control px-2 w-100"
                                   id="txtMessage"
                                   ref="txtMessage"
                                   placeholder="Написать сообщение..." />
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-2 ">
                <div class="btn-group">
                    <button class="btn btn-link mx-0 px-1 btn-add-file" type="button">
                        <svg width="18" height="18" viewBox="0 0 501 450" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M386.25 0.776009C362.667 3.95101 342.893 14.031 322.181 33.435C310.153 44.704 143.995 211.364 140.324 215.842C133.544 224.112 127.238 234.617 124.021 243C121.439 249.729 120.42 254.988 120.137 263.05C119.706 275.316 120.918 281.363 125.788 291.25C132.814 305.514 145.215 318.013 159.25 324.974C165.306 327.977 169.015 329.236 174.767 330.239C189.356 332.783 205.894 329.107 221.122 319.935C228.267 315.632 232.697 312.212 240.239 305.175C249.001 297 367.898 177.804 369.919 175.168C370.798 174.023 372.131 171.773 372.883 170.168C374.695 166.3 374.789 160.218 373.102 156C370.747 150.112 364.804 143.993 358.631 141.1C356.1 139.914 355.143 139.751 350.75 139.755C345.316 139.759 343.608 140.339 339.25 143.656C338.15 144.493 307.438 174.915 271 211.26C203.163 278.925 202.009 280.018 195.483 282.861C189.392 285.514 182.863 285.661 177.806 283.26C173.843 281.378 169.564 277.018 167.437 272.695C165.885 269.542 165.753 268.906 165.786 264.759C165.829 259.397 167.194 255.334 170.721 250.07C173.957 245.242 360.973 58.4705 365.5 55.547C386.322 42.0995 408.484 42.8975 428.306 57.8095C433.74 61.8975 443.799 72.62 446.921 77.652C455.694 91.795 457.663 105.718 452.938 120.195C451.019 126.073 447.778 132.533 444.17 137.667C441.973 140.794 413.829 169.258 324.026 259.179C251.052 332.248 204.861 378.132 201.75 380.641C185.566 393.692 168.716 401.327 151.236 403.527C145.162 404.292 131.68 403.864 126.5 402.743C116.859 400.656 104.399 395.346 95.75 389.638C72.076 374.016 53.001 348.174 48.283 325.333C45.355 311.156 46.2705 297.217 51.087 282.644C53.7495 274.588 58.3805 265.202 63.494 257.5C67.628 251.272 67.9695 250.923 158.238 160.5C222.34 96.2885 249.444 68.8175 250.921 66.561C255.099 60.1815 255.633 53.541 252.485 47.14C250.165 42.4245 243.99 36.276 239.242 33.9565C236.013 32.3785 235.392 32.25 230.99 32.25C226.607 32.25 225.961 32.382 222.853 33.912C220.549 35.0465 217.693 37.214 213.863 40.736C210.776 43.5745 170.653 83.5515 124.702 129.574C40.943 213.46 36.9695 217.586 28.5475 229.412C4.60204 263.034 -4.07845 300.413 3.81154 335.924C9.12604 359.843 23.584 384.11 45.6045 406.071C64.946 425.36 86.9315 439.19 107.796 445.192C136.41 453.423 163.645 451.021 194.491 437.545C208.507 431.422 225.62 419.851 238.76 407.613C250.4 396.77 472.102 174.546 475.511 170.303C483.596 160.24 492.229 145.082 495.913 134.482C499.889 123.039 501.248 113.795 500.856 100.843C500.552 90.795 499.637 85.767 496.289 75.7635C493.121 66.2965 486.288 54.365 478.475 44.662C474.126 39.26 460.641 25.9155 455.5 21.9255C433.654 4.97101 409.618 -2.36949 386.25 0.776009Z" />
                        </svg>
                    </button>
                    <button class="btn btn-link mx-0 px-1 btn-add-camera" type="button">
                        <svg version="1.1" id="add-camera" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  width="18px" height="18"
                             viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                            <g>
                                <path d="M256,157c-68.925,0-125,56.075-125,125s56.075,125,125,125s125-56.075,125-125S324.925,157,256,157z M256,367
                                    c-46.869,0-85-38.131-85-85c0-46.869,38.131-85,85-85s85,38.131,85,85C341,328.869,302.869,367,256,367z"/>
                                <path d="M452,97h-73.575c-2.329,0-4.428-1.271-5.508-3.327L352.562,50.9c-0.056-0.117-0.112-0.233-0.171-0.349
                                    C344.512,34.791,328.67,25,311.049,25H202.376c-17.621,0-33.463,9.791-41.342,25.552c-0.059,0.116-0.115,0.232-0.171,0.349
                                    l-20.356,42.775C139.427,95.729,137.329,97,135,97H60c-33.084,0-60,26.916-60,60v270c0,33.084,26.916,60,60,60h392
                                    c33.084,0,60-26.916,60-60V157C512,123.916,485.084,97,452,97z M472,426.999c0,11.028-8.972,20-20,20H60
                                    c-11.028,0-20-8.972-20-20V157c0-11.028,8.972-20,20-20h75c17.62,0,33.462-9.79,41.342-25.55c0.059-0.116,0.115-0.233,0.172-0.35
                                    l20.356-42.775c1.079-2.054,3.177-3.325,5.506-3.325h108.673c2.329,0,4.427,1.271,5.506,3.324l20.356,42.775
                                    c0.057,0.117,0.113,0.234,0.172,0.35c7.88,15.76,23.722,25.55,41.342,25.55H452c11.028,0,20,8.972,20,20V426.999z"/>
                                <rect x="392" y="177" width="40" height="40"/>
                            </g>
                        </svg>
                    </button>
                    <button class="btn btn-link mx-0 px-1 btn-add-smile" type="button">
                        <svg viewBox="0 0 384 384"  xmlns="http://www.w3.org/2000/svg"><path d="m245.449219 235.894531c-14.777344 12.960938-33.753907 20.105469-53.449219 20.105469-19.703125 0-38.65625-7.113281-53.367188-20.023438l-12.023437-10.550781-21.113281 24.046875 12.023437 10.550782c20.550781 18.039062 47 27.976562 74.480469 27.976562 27.472656 0 53.945312-9.96875 74.550781-28.054688l12.023438-10.554687-21.109375-24.046875zm0 0"/><path d="m192 0c-105.871094 0-192 86.128906-192 192s86.128906 192 192 192 192-86.128906 192-192-86.128906-192-192-192zm0 352c-88.222656 0-160-71.777344-160-160s71.777344-160 160-160 160 71.777344 160 160-71.777344 160-160 160zm0 0"/><path d="m112 144h32v32h-32zm0 0"/><path d="m240 144h32v32h-32zm0 0"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import moment from 'moment';

export default {
name: 'ChatFooter',
props: {
    currentDialog: Object
},

data() {
    return {
        newMessage: ``,
    }
},

methods: {
    onMessageKeyDown(ev) {
        if (13===ev.keyCode  &&  this.newMessage.trim()!=='') {
            const newMsg = {
                body: this.newMessage.trim(),
                createdAt: moment().unix(),
                isMine: true,
                isRead: false,
                isEdited: false
            };

            const evData = {
                message : newMsg,
                chatId : (this.currentDialog) ? this.currentDialog.id : -1
            };

            this.$root.$emit('sentNewChatMessageToAPI', evData);

            this.newMessage = ``;
        }
    }
},

computed : {
    userPic : function () {
        return (this.currentDialog  &&  this.currentDialog.userPic) ? this.currentDialog.userPic : this.$defaultAvatarPath;
    }
},

mounted() {
}

}
</script>
