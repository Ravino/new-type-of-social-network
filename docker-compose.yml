version: "3.1"
services:
  mysql:
    image: mysql:5.7
    container_name: "plizi_mysql"
    command: mysqld --character-set-server=utf8 --collation-server=utf8_general_ci
    volumes:
      - mysql_data_plizi:/var/lib/mysql
    env_file:
      - ./backend/docker/mysql/.env
    ports:
      - "3306:3306"

  app_nginx:
    image: nginx
    container_name: "plizi_nginx_app"
    working_dir: /app
    volumes:
      - ./frontend/docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ./frontend:/app
    ports:
      - "80:80"
    depends_on:
      - php_api

  app_node:
    build: ./frontend/docker/node
    container_name: "plizi_node_app"
    tty: true
    volumes:
      - ./frontend:/app

  api_nginx:
    image: nginx
    container_name: "plizi_nginx_api"
    working_dir: /app
    volumes:
      - ./backend/docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ./backend:/app
    ports:
      - "81:80"
    depends_on:
      - php_api

  php_api:
    build: ./backend/docker/
    container_name: "plizi_api"
    working_dir: /app
    volumes:
      - ./backend:/app
    depends_on:
      - mysql

  redis:
    image: redis
    container_name: "plizi_redis"
    env_file:
      - ./backend/docker/redis/.env
    volumes:
      - redis_data_plizi:/data
    ports:
    - "6379:6379"

  node:
    build: ./backend/docker/node
    container_name: "plizi_node_ws"
    tty: true
    volumes:
      - ./backend:/app
    ports:
    - "6061:6061"

volumes:
  mysql_data_plizi:
  redis_data_plizi:
